import {
  ADDON_ID,
  DEFAULT_ADDON_STATE,
  DEFAULT_THEME_PARAMETERS,
  GLOBAL_KEY,
  PARAM_KEY,
  THEME_SWITCHER_ID,
  THEMING_EVENTS,
  __name
} from "./_browser-chunks/chunk-D4FRO6NL.js";

// src/manager.tsx
import { addons as addons2, types } from "storybook/manager-api";

// src/theme-switcher.tsx
import React from "react";
import { IconButton, TooltipLinkList, WithTooltip } from "storybook/internal/components";
import { PaintBrushIcon } from "@storybook/icons";
import { addons, useAddonState, useChannel, useGlobals, useParameter } from "storybook/manager-api";
import { styled } from "storybook/theming";
var IconButtonLabel = styled.div(({ theme }) => ({
  fontSize: theme.typography.size.s2 - 1
}));
var hasMultipleThemes = /* @__PURE__ */ __name((themesList) => themesList.length > 1, "hasMultipleThemes");
var hasTwoThemes = /* @__PURE__ */ __name((themesList) => themesList.length === 2, "hasTwoThemes");
var ThemeSwitcher = React.memo(/* @__PURE__ */ __name(function ThemeSwitcher2() {
  const { themeOverride, disable } = useParameter(
    PARAM_KEY,
    DEFAULT_THEME_PARAMETERS
  );
  const [{ theme: selected }, updateGlobals, storyGlobals] = useGlobals();
  const channel = addons.getChannel();
  const fromLast = channel.last(THEMING_EVENTS.REGISTER_THEMES);
  const initializeThemeState = Object.assign({}, DEFAULT_ADDON_STATE, {
    themesList: fromLast?.[0]?.themes || [],
    themeDefault: fromLast?.[0]?.defaultTheme || ""
  });
  const [{ themesList, themeDefault }, updateState] = useAddonState(
    THEME_SWITCHER_ID,
    initializeThemeState
  );
  const isLocked = GLOBAL_KEY in storyGlobals || !!themeOverride;
  useChannel({
    [THEMING_EVENTS.REGISTER_THEMES]: ({ themes, defaultTheme }) => {
      updateState((state) => ({
        ...state,
        themesList: themes,
        themeDefault: defaultTheme
      }));
    }
  });
  const themeName = selected || themeDefault;
  let label = "";
  if (isLocked) {
    label = "Story override";
  } else if (themeName) {
    label = `${themeName} theme`;
  }
  if (disable) {
    return null;
  }
  if (hasTwoThemes(themesList)) {
    const currentTheme = selected || themeDefault;
    const alternateTheme = themesList.find((theme) => theme !== currentTheme);
    return React.createElement(
      IconButton,
      {
        disabled: isLocked,
        key: THEME_SWITCHER_ID,
        active: !themeOverride,
        title: "Theme",
        onClick: () => {
          updateGlobals({ theme: alternateTheme });
        }
      },
      React.createElement(PaintBrushIcon, null),
      label ? React.createElement(IconButtonLabel, null, label) : null
    );
  }
  if (hasMultipleThemes(themesList)) {
    return React.createElement(
      WithTooltip,
      {
        placement: "top",
        trigger: "click",
        closeOnOutsideClick: true,
        tooltip: ({ onHide }) => {
          return React.createElement(
            TooltipLinkList,
            {
              links: themesList.map((theme) => ({
                id: theme,
                title: theme,
                active: selected === theme,
                onClick: /* @__PURE__ */ __name(() => {
                  updateGlobals({ theme });
                  onHide();
                }, "onClick")
              }))
            }
          );
        }
      },
      React.createElement(
        IconButton,
        {
          key: THEME_SWITCHER_ID,
          active: !themeOverride,
          title: "Theme",
          disabled: isLocked
        },
        React.createElement(PaintBrushIcon, null),
        label && React.createElement(IconButtonLabel, null, label)
      )
    );
  }
  return null;
}, "ThemeSwitcher"));

// src/manager.tsx
addons2.register(ADDON_ID, () => {
  addons2.add(THEME_SWITCHER_ID, {
    title: "Themes",
    type: types.TOOL,
    match: /* @__PURE__ */ __name(({ viewMode, tabId }) => !!(viewMode && viewMode.match(/^(story|docs)$/)) && !tabId, "match"),
    render: ThemeSwitcher,
    paramKey: PARAM_KEY
  });
});
